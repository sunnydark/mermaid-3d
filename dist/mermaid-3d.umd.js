(function(S,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(S=typeof globalThis<"u"?globalThis:S||self,b(S.mermaid3d={}))})(this,(function(S){"use strict";let b={},C=null;async function q(){if(!C){if(typeof window<"u"&&window.mermaid)C=window.mermaid;else{const e=await import("mermaid");C=e.default||e}C.initialize({startOnLoad:!1,securityLevel:"loose",...b})}return C}let $=0;const g="http://www.w3.org/2000/svg",M=.707,Y=-.5,X=.707,I=.5,R=`matrix(${M} ${Y} ${X} ${I} 0 0)`;function B(e){var o;let s=e.querySelector("defs");s||(s=document.createElementNS(g,"defs"),e.insertBefore(s,e.firstChild));const i=document.createElementNS(g,"filter");i.setAttribute("id","mermaid3d-shadow"),i.setAttribute("x","-30%"),i.setAttribute("y","-30%"),i.setAttribute("width","180%"),i.setAttribute("height","180%");const t=document.createElementNS(g,"feOffset");t.setAttribute("in","SourceAlpha"),t.setAttribute("dx","6"),t.setAttribute("dy","8"),t.setAttribute("result","offsetAlpha"),i.appendChild(t);const a=document.createElementNS(g,"feGaussianBlur");a.setAttribute("in","offsetAlpha"),a.setAttribute("stdDeviation","5"),a.setAttribute("result","blurred"),i.appendChild(a);const c=document.createElementNS(g,"feFlood");c.setAttribute("flood-color","black"),c.setAttribute("flood-opacity","0.25"),c.setAttribute("result","color"),i.appendChild(c);const l=document.createElementNS(g,"feComposite");l.setAttribute("in","color"),l.setAttribute("in2","blurred"),l.setAttribute("operator","in"),l.setAttribute("result","shadow"),i.appendChild(l);const d=document.createElementNS(g,"feMerge"),u=document.createElementNS(g,"feMergeNode");u.setAttribute("in","shadow"),d.appendChild(u);const f=document.createElementNS(g,"feMergeNode");f.setAttribute("in","SourceGraphic"),d.appendChild(f),i.appendChild(d),s.appendChild(i);const h=[];e.querySelectorAll(".node").forEach(r=>h.push(r)),e.querySelectorAll("rect.actor").forEach(r=>{const p=r.closest("g[id]")||r.parentElement;p&&p.tagName==="g"&&!h.includes(p)&&h.push(p)}),e.querySelectorAll("rect.task").forEach(r=>h.push(r)),e.querySelectorAll("rect.journey-section").forEach(r=>h.push(r));const w=e.querySelector("path.pieCircle");((o=w==null?void 0:w.parentElement)==null?void 0:o.tagName)==="g"&&h.push(w.parentElement),e.querySelectorAll('rect[class*="task"]').forEach(r=>{h.includes(r)||h.push(r)});const n=e.querySelector("g.commit-bullets:not(:empty)");n&&h.push(n);const m=e.querySelector("g.commit-arrows");m&&h.push(m),e.querySelectorAll("line.branch").forEach(r=>h.push(r)),e.querySelectorAll(".branchLabel").forEach(r=>h.push(r)),e.querySelectorAll("rect.branchLabelBkg").forEach(r=>h.push(r)),e.querySelectorAll(".timeline-node").forEach(r=>h.push(r));for(const r of h)r.setAttribute("filter","url(#mermaid3d-shadow)")}function T(e){const s=document.createElementNS(g,"g");for(s.setAttribute("transform",R);e.firstChild;)s.appendChild(e.firstChild);e.appendChild(s);const i=s.getBBox(),t=[[i.x,i.y],[i.x+i.width,i.y],[i.x+i.width,i.y+i.height],[i.x,i.y+i.height]];let a=1/0,c=1/0,l=-1/0,d=-1/0;for(const[f,h]of t){const w=M*f+X*h,n=Y*f+I*h;a=Math.min(a,w),c=Math.min(c,n),l=Math.max(l,w),d=Math.max(d,n)}const u=30;e.setAttribute("viewBox",`${a-u} ${c-u} ${l-a+2*u} ${d-c+2*u}`)}function _(e){const s=(e.getAttribute("viewBox")||"0 0 800 600").split(/[\s,]+/).map(Number);return{x:s[0],y:s[1],w:s[2],h:s[3]}}function D(e,s){const i=s.getBoundingClientRect();if(i.width===0||i.height===0)return e;const t=i.width/i.height,a=e.w/e.h;if(t>a){const c=e.h*t;return{x:e.x-(c-e.w)/2,y:e.y,w:c,h:e.h}}else{const c=e.w/t;return{x:e.x,y:e.y-(c-e.h)/2,w:e.w,h:c}}}function O(e,s){s.setAttribute("preserveAspectRatio","none");const i=_(s);let t=D(i,e),a=!1,c=0,l=0,d=0;function u(){s.setAttribute("viewBox",`${t.x} ${t.y} ${t.w} ${t.h}`)}u();function f(){d&&(cancelAnimationFrame(d),d=0)}function h(n,m=600){f();const o={...t},r=performance.now();function p(y){const A=Math.min((y-r)/m,1),x=1-Math.pow(1-A,3);t.x=o.x+(n.x-o.x)*x,t.y=o.y+(n.y-o.y)*x,t.w=o.w+(n.w-o.w)*x,t.h=o.h+(n.h-o.h)*x,u(),A<1?d=requestAnimationFrame(p):d=0}d=requestAnimationFrame(p)}e.addEventListener("wheel",n=>{n.preventDefault(),f();const m=n.deltaY>0?1.08:1/1.08,o=e.getBoundingClientRect(),r=(n.clientX-o.left)/o.width,p=(n.clientY-o.top)/o.height,y=t.w*m,A=t.h*m;t.x-=(y-t.w)*r,t.y-=(A-t.h)*p,t.w=y,t.h=A,u()},{passive:!1}),e.addEventListener("mousedown",n=>{(n.button===0||n.button===1)&&(f(),a=!0,c=n.clientX,l=n.clientY,e.style.cursor="grabbing",n.preventDefault())}),window.addEventListener("mousemove",n=>{if(!a)return;const m=n.clientX-c,o=n.clientY-l;c=n.clientX,l=n.clientY;const r=e.getBoundingClientRect();t.x-=m*(t.w/r.width),t.y-=o*(t.h/r.height),u()}),window.addEventListener("mouseup",()=>{a&&(a=!1,e.style.cursor="grab")}),e.addEventListener("dblclick",n=>{const m=n.target.closest(".node");if(!m)return;const o=m.getBoundingClientRect(),r=e.getBoundingClientRect(),p=t.x+(o.left+o.width/2-r.left)/r.width*t.w,y=t.y+(o.top+o.height/2-r.top)/r.height*t.h,A=o.width/r.width*t.w,x=o.height/r.height*t.h,E=Math.max(A,x)/.2,L=E*(r.height/r.width);h({x:p-E/2,y:y-L/2,w:E,h:L})});let w=0;e.addEventListener("touchstart",n=>{if(f(),n.touches.length===1)a=!0,c=n.touches[0].clientX,l=n.touches[0].clientY;else if(n.touches.length===2){a=!1;const m=n.touches[1].clientX-n.touches[0].clientX,o=n.touches[1].clientY-n.touches[0].clientY;w=Math.sqrt(m*m+o*o)}n.preventDefault()},{passive:!1}),e.addEventListener("touchmove",n=>{if(n.touches.length===1&&a){const m=n.touches[0].clientX-c,o=n.touches[0].clientY-l;c=n.touches[0].clientX,l=n.touches[0].clientY;const r=e.getBoundingClientRect();t.x-=m*(t.w/r.width),t.y-=o*(t.h/r.height),u()}else if(n.touches.length===2){const m=n.touches[1].clientX-n.touches[0].clientX,o=n.touches[1].clientY-n.touches[0].clientY,r=Math.sqrt(m*m+o*o),p=w/r,y=e.getBoundingClientRect(),A=((n.touches[0].clientX+n.touches[1].clientX)/2-y.left)/y.width,x=((n.touches[0].clientY+n.touches[1].clientY)/2-y.top)/y.height,v=t.w*p,E=t.h*p;t.x-=(v-t.w)*A,t.y-=(E-t.h)*x,t.w=v,t.h=E,w=r,u()}n.preventDefault()},{passive:!1}),e.addEventListener("touchend",()=>{a=!1}),e.style.cursor="grab"}const k=`
.mermaid-3d-container {
  overflow: hidden;
  position: relative;
}
.mermaid-3d-container svg {
  display: block;
  width: 100%;
  height: 100%;
}
`;function z(){if(document.getElementById("mermaid-3d-styles"))return;const e=document.createElement("style");e.id="mermaid-3d-styles",e.textContent=k,document.head.appendChild(e)}function H(e){const s=document.createElement("div");return s.id=e,s.className="mermaid-3d-container",s}const N={initialize(e={}){b={...b,...e},C=null},async render(e,s,i){z();const t=await q(),a=`mermaid3d-render-${$++}`,{svg:c}=await t.render(a,s),l=H(e);l.innerHTML=c,i&&i.appendChild(l);const d=l.querySelector("svg"),u=()=>{d&&(d.removeAttribute("width"),d.removeAttribute("height"),d.style.maxWidth="none",b.shadows!==!1&&B(d),T(d),O(l,d))};return i&&u(),{svg:c,element:l,bindFunctions:f=>{},finalize:u}},async run(e){var t;const s=(e==null?void 0:e.querySelector)||"pre.mermaid, div.mermaid, .mermaid",i=e!=null&&e.nodes?Array.from(e.nodes):Array.from(document.querySelectorAll(s));for(let a=0;a<i.length;a++){const c=i[a],l=(t=c.textContent)==null?void 0:t.trim();if(!l)continue;const d=c.id||`mermaid-3d-${a}`;try{const u=await this.render(d,l),f=c.parentNode;f&&(u.element.id=d,f.replaceChild(u.element,c),u.finalize()),e!=null&&e.postRenderCallback&&e.postRenderCallback(d)}catch(u){e!=null&&e.suppressErrors||console.error(`mermaid-3d: Failed to render diagram ${d}:`,u)}}},async parse(e,s){const t=await(await q()).parse(e);return{diagramType:(t==null?void 0:t.diagramType)||"unknown"}},async registerExternalDiagrams(e){const s=await q();typeof s.registerExternalDiagrams=="function"&&await s.registerExternalDiagrams(e)},setParseErrorHandler(e){b.__parseErrorHandler=e},mermaidAPI:{initialize(e){N.initialize(e)},async render(e,s,i){return N.render(e,s,i)},async parse(e){return N.parse(e)}}};S.default=N,S.mermaid3d=N,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
